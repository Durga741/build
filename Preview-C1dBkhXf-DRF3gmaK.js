import{o as v,en as g,cj as y,j as e,ck as C,cl as T,bl as j,c as L,d as u,A as f,cn as I,u as p,aQ as x,r as M,cr as R,ci as D,eo as F,co as k,cp as B,l as E,a as H,bB as A,G as h,I as P,dw as S,h as N,b9 as q,bu as z,bT as Q,cv as $}from"./strapi-BDL4OyES.js";import{getDocumentStatus as b}from"./EditViewPage-COVXj9bh-Bx7BT2Ou.js";import"./Field-CcppsFQR-D91D3MML.js";import"./Relations-Bvne4TvU-HGoWFXsw.js";import"./useDragAndDrop-DJ6jqvZN-B7lMSF5H.js";import"./relations-CBc5HYHC-DiJ0Pn5q.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-Buav4fjM.js";import"./objects-D6yBsdmx-BJmwiqLV.js";import"./useDebounce-DmuSJIF3-KOTixump.js";const G=()=>{const t=c("PreviewContent",r=>r.url),{formatMessage:s}=p();return e.jsx(f,{src:t,title:s({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"})},U=()=>{const[{query:t}]=x(),{formatMessage:s}=p();return e.jsx(P,{tag:q,relative:"path",to:{pathname:"..",search:z.stringify({plugins:t.plugins},{encode:!1})},label:s({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(Q,{})})},W=()=>{const t=c("PreviewHeader",a=>a.document),s=c("PreviewHeader",a=>a.schema),r=c("PreviewHeader",a=>a.meta);if(!(s?.options?.draftAndPublish??!1))return null;const i=b(t,r);return e.jsx($,{status:i,size:"XS"})},O=()=>{const{formatMessage:t}=p(),[{query:s},r]=x(),o=c("PreviewHeader",d=>d.document),i=c("PreviewHeader",d=>d.schema),a=c("PreviewHeader",d=>d.meta),l=i?.options?.draftAndPublish??!1,n=b(o,a),m=d=>{(d==="published"||d==="draft")&&r({status:d},"push",!0)};return l?e.jsx(e.Fragment,{children:e.jsx(g.Root,{variant:"simple",value:s.status||"draft",onValueChange:m,children:e.jsxs(g.List,{"aria-label":t({id:"preview.tabs.label",defaultMessage:"Document status"}),children:[e.jsx(w,{value:"draft",children:t({id:"content-manager.containers.List.draft",defaultMessage:"draft"})}),e.jsx(w,{value:"published",disabled:n==="draft",children:t({id:"content-manager.containers.List.published",defaultMessage:"published"})})]})})}):null},V=()=>{const t=c("PreviewHeader",n=>n.mainField),r=c("PreviewHeader",n=>n.document)[t],{formatMessage:o}=p(),{toggleNotification:i}=H(),{copy:a}=A(),l=()=>{a(window.location.href),i({message:o({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(h.Root,{gap:3,gridCols:3,paddingLeft:2,paddingRight:2,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(h.Item,{xs:1,paddingTop:2,paddingBottom:2,gap:3,children:[e.jsx(U,{}),e.jsx(X,{tag:"h1",fontWeight:600,fontSize:2,maxWidth:"200px",children:r}),e.jsx(W,{})]}),e.jsx(h.Item,{xs:1,marginBottom:"-1px",alignItems:"end",margin:"auto",children:e.jsx(O,{})}),e.jsx(h.Item,{xs:1,justifyContent:"end",paddingTop:2,paddingBottom:2,children:e.jsx(P,{type:"button",label:o({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:l,children:e.jsx(S,{})})})]})},X=v(N)`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,w=v(g.Trigger)`
  text-transform: uppercase;
`,[Y,c]=y("PreviewPage"),_=()=>{const{formatMessage:t}=p(),{slug:s,id:r,collectionType:o}=j(),[{query:i}]=x(),a=M.useMemo(()=>R(i),[i]);if(!o)throw new Error("Could not find collectionType in url params");if(!s)throw new Error("Could not find model in url params");if(o===D&&!r)throw new Error("Could not find documentId in url params");const l=F({params:{contentType:s},query:{documentId:r,locale:a.locale,status:a.status}}),n=k({model:s,collectionType:o,documentId:r,params:a}),m=B(s);return n.isLoading||l.isLoading||m.isLoading?e.jsx(u.Loading,{}):l.error||m.error||!n.document||!n.meta||!n.schema?e.jsx(u.Error,{}):l.data?.data?.url?e.jsxs(e.Fragment,{children:[e.jsx(u.Title,{children:t({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:m.edit.settings.displayName})}),e.jsx(Y,{url:l.data.data.url,mainField:m.edit.settings.mainField,document:n.document,meta:n.meta,schema:n.schema,children:e.jsxs(E,{direction:"column",height:"100%",alignItems:"stretch",children:[e.jsx(V,{}),e.jsx(G,{})]})})]}):e.jsx(u.NoData,{})},J=()=>{const{slug:t}=j(),{permissions:s=[],isLoading:r,error:o}=L([{action:"plugin::content-manager.explorer.read",subject:t}]);return r?e.jsx(u.Loading,{}):o||!t?e.jsx(f,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(u.Error,{})}):e.jsx(f,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(u.Protect,{permissions:s,children:({permissions:i})=>e.jsx(I,{permissions:i,children:e.jsx(_,{})})})})},de=()=>e.jsx(C,{children:e.jsx(T,{children:e.jsx(J,{})})});export{de as ProtectedPreviewPage,c as usePreviewContext};
